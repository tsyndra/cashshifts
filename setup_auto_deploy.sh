#!/bin/bash
# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð´ÐµÐ¿Ð»Ð¾Ñ Ñ‡ÐµÑ€ÐµÐ· Git hooks

PROJECT_DIR="/home/workdir/cash_shifts"
cd "$PROJECT_DIR"

echo "======================================================"
echo "âš™ï¸  ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð§Ð•Ð¡ÐšÐžÐ“Ðž Ð”Ð•ÐŸÐ›ÐžÐ¯"
echo "======================================================"
echo ""

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ Ð´Ð»Ñ git hooks ÐµÑÐ»Ð¸ ÐµÐµ Ð½ÐµÑ‚
if [ ! -d ".git" ]; then
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: Ð­Ñ‚Ð¾ Ð½Ðµ git Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹"
    echo "Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ git: git init"
    exit 1
fi

mkdir -p .git/hooks

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ post-commit hook
echo "ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ post-commit hook..."

cat > .git/hooks/post-commit << 'EOF'
#!/bin/bash
# Git hook: Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð¿Ð¾ÑÐ»Ðµ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°

echo ""
echo "ðŸ”„ ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð½Ð¾Ð²Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² ÐºÐ¾Ð´Ðµ"
echo "Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð´ÐµÐ¿Ð»Ð¾Ð¹..."
echo ""

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´ÐµÐ¿Ð»Ð¾Ñ
./deploy_to_production.sh

EOF

# Ð”ÐµÐ»Ð°ÐµÐ¼ hook Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¼
chmod +x .git/hooks/post-commit

echo "âœ… post-commit hook ÑÐ¾Ð·Ð´Ð°Ð½"

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ post-merge hook (ÑÑ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð¿Ñ€Ð¸ git pull)
echo "ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ post-merge hook..."

cat > .git/hooks/post-merge << 'EOF'
#!/bin/bash
# Git hook: Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð¿Ð¾ÑÐ»Ðµ git pull

echo ""
echo "ðŸ”„ ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÐ»Ðµ git pull"
echo "Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð´ÐµÐ¿Ð»Ð¾Ð¹..."
echo ""

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´ÐµÐ¿Ð»Ð¾Ñ
./deploy_to_production.sh

EOF

# Ð”ÐµÐ»Ð°ÐµÐ¼ hook Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¼
chmod +x .git/hooks/post-merge

echo "âœ… post-merge hook ÑÐ¾Ð·Ð´Ð°Ð½"

echo ""
echo "======================================================"
echo "âœ… ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð§Ð•Ð¡ÐšÐ˜Ð™ Ð”Ð•ÐŸÐ›ÐžÐ™ ÐÐÐ¡Ð¢Ð ÐžÐ•Ð!"
echo "======================================================"
echo ""
echo "Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸:"
echo "  â€¢ ÐŸÐ¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ git commit"
echo "  â€¢ ÐŸÐ¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ git pull"
echo ""
echo "Ð”Ð»Ñ Ñ€ÑƒÑ‡Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¿Ð»Ð¾Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ:"
echo "  ./deploy_to_production.sh"
echo ""
echo "Ð”Ð»Ñ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð°Ð²Ñ‚Ð¾Ð´ÐµÐ¿Ð»Ð¾Ñ:"
echo "  rm .git/hooks/post-commit"
echo "  rm .git/hooks/post-merge"
echo ""

