#!/bin/bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–±–µ–∑ sudo)

cd /home/workdir/cash_shifts

# –£–±–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—à–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã (–Ω–µ root)
pkill -u tsyndra -f "python.*app.py" 2>/dev/null

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
sleep 2

# –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
nohup python3 app.py > /tmp/cashshifts.log 2>&1 &

echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ"
echo "üìç –ü–æ—Ä—Ç: 5003"
echo "üìù –õ–æ–≥–∏: /tmp/cashshifts.log"
echo "üîç PID: $!"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å
sleep 2
if ss -tln | grep -q ":5003"; then
    echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5003"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: tail -f /tmp/cashshifts.log"
fi

